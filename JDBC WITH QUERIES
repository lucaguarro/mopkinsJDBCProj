package jbdc;

import java.sql.*;
import java.util.Scanner;

public class JBDC {
   
  
   static final String JDBC_DRIVER = "org.apache.derby.jdbc.ClientDriver";  
   static final String DB_URL = "jdbc:derby://localhost:1527/Tables";

   //  Database credentials
   static final String USER = "tay";
   static final String PASS = "tay";
   
   public static void main(String[] args) {
       
   
   Connection conn = null;
   Statement stmt = null;
   try{
      //STEP 2: Register JDBC driver
      Class.forName("org.apache.derby.jdbc.ClientDriver");

      //STEP 3: Open a connection
      System.out.println("Connecting to a selected database...");
      conn = DriverManager.getConnection(DB_URL, USER, PASS);
      System.out.println("Connected database successfully...");
      
         
      //STEP 4: Execute a query
      System.out.println("Creating statement...");
    
      stmt = conn.createStatement();
      Statement statement = conn.createStatement();
      
      int choice = menu();
      
      switch(choice)
      {
      case 1:
      ShowGroups(statement);
       //break;
         
      //case 2:
      //ShowGroupData(statement);
      
      case 3:
      ShowPublisher(statement);   
      break;
       
      case 5:
      ShowBooks(statement); 
      break;
      
      case 7:
      InsertBook(statement);
      break;
            
      case 10:
       break;
   }        
                
                
                
   }catch(SQLException se){
      //Handle errors for JDBC
      se.printStackTrace();
   }catch(Exception e){
      //Handle errors for Class.forName
      e.printStackTrace();
   }finally{
      //finally block used to close resources
      try{
         if(stmt!=null)
            conn.close();
      }catch(SQLException se){
      }// do nothing
      try{
         if(conn!=null)
            conn.close();
      }catch(SQLException se){
         se.printStackTrace();
      }//end finally try
   }//end try
   System.out.println("\nGoodbye!");
}

   public static int menu()
   {
       Scanner input = new Scanner(System.in);

       System.out.print("\n + "
              + "\n1. List all writing groups.\n"
              + "2. List all the data for a group specified by the user.\n"
              + "3. List all publishers.\n"
              + "4. List all the data for a pubisher specified by the user.\n"
              + "5. List all book titles.\n" 
              + "6. List all the data for a book specified by the user.\n"
              + "7. Insert a new book.\n"
              + "8. Insert a new publisher and update all book published by one publisher to be published by the new pubisher. \n"
              + "9. Remove a book specified by the user. \n"
              + "10. Quit.\n\n"
              + "Selection: ");
      
              int selection = input.nextInt();
              System.out.println("");
              
              return selection;
   }
 
   public static void ShowGroups(Statement stmt) throws SQLException
   {
      String sqlStr;
      sqlStr = "Select * from writinggroups";
      ResultSet rs = stmt.executeQuery(sqlStr);

      System.out.print("Writing Groups: \n");
       while (rs.next()) {
                String sname = rs.getString(1);
                System.out.println(sname);
       }      
   }
   
   
   
   public static void ShowBooks(Statement stmt) throws SQLException
   {
      String sqlStr;
      sqlStr = "Select * from Books";
      ResultSet rs = stmt.executeQuery(sqlStr);

      System.out.print("Books: ");
       while (rs.next()) {
                String books = rs.getString(1);
                System.out.println(books);
       }      
   }
   
   
   public static void ShowPublisher(Statement stmt) throws SQLException
   {
      String sqlStr;
      sqlStr = "Select * from publishers";
      ResultSet rs = stmt.executeQuery(sqlStr);

      System.out.print("Publishers: ");
      System.out.println("");
       while (rs.next()) {
                String publishers = rs.getString(1);
                System.out.println(publishers);
       }      
   }
   
   public static void InsertBook(Statement stmt) throws SQLException
   {
    
       Scanner input = new Scanner(System.in);
       System.out.print("Enter book title: ");
       String title = input.nextLine();
       System.out.println("");
       
       System.out.print("Enter year published: ");
       int year = input.nextInt();
              System.out.println("");

       
       System.out.print("Enter the number of pages: ");
       int numPages = input.nextInt();
              System.out.println("");

       
       input.nextLine();
       
       System.out.print("Choose which group to add book to: \n");
       
       ShowGroups(stmt);
       System.out.print("Selection: ");
       String group = input.nextLine();
       System.out.println("");
       
       ShowPublisher(stmt);
       System.out.print("Selection: ");
       String publisher = input.nextLine();
       System.out.println("");
       System.out.println("publisher given: " + publisher);

       String sql = "INSERT INTO Books (BookTitle, PublisherName, yearPublished, GroupName,numberPages)"
                                + "VALUES ('" + title + "', '" + publisher + "'," + year + ", '" + group + "', "+ numPages +") ";
            stmt.executeUpdate(sql);
        System.out.println("New book have been inserted");
       
   }
}
